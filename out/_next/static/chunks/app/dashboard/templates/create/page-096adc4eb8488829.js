(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[591],{29924:function(e,a,s){Promise.resolve().then(s.bind(s,23615))},23615:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return k}});var r=s(57437),l=s(2265),t=s(99376),i=s(8530),c=s(41671),n=s(76865),o=s(99388),d=s(32660),m=s(82023),x=s(99397),u=s(18930),p=s(42208),h=s(82222);let b=(0,s(79205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var g=s(25846),j=s(49322),y=s(61649),f=s(83229),v=s(56426),N=s(66070),w=s(76362);function k(){let e;let{user:a}=(0,w.a)(),s=(0,t.useRouter)(),[k,C]=(0,l.useState)(""),[Z,S]=(0,l.useState)(""),[z,M]=(0,l.useState)("general"),[A,E]=(0,l.useState)([]),[P,D]=(0,l.useState)(""),[V,T]=(0,l.useState)(!1),[F,I]=(0,l.useState)(null),[R,O]=(0,l.useState)(null),[q,_]=(0,l.useState)(!1),[B,H]=(0,l.useState)(!1),L=()=>{P.trim()&&!A.includes(P.trim())&&(E([...A,P.trim()]),D(""))},J=e=>{E(A.filter((a,s)=>s!==e))},G=async()=>{if(!k.trim()||!Z.trim()){alert("Nombre y contenido son requeridos");return}T(!0),I(null),O(null);try{let e=localStorage.getItem("token"),a=await fetch("".concat(i.T,"/api/templates-ai/validate"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({name:k,content:Z,category:z,variables:A})}),s=await a.json();s.success?(I(s.validation),O(s.excelGuide)):alert(s.error||"Error en la validaci\xf3n")}catch(e){console.error("Error validating template:",e),alert("Error de conexi\xf3n")}finally{T(!1)}},U=async()=>{if(!F){alert("La plantilla debe ser validada por IA antes de crearla");return}_(!0);try{let e=localStorage.getItem("token"),a=await fetch("".concat(i.T,"/api/templates-ai/create"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({name:k,content:Z,category:z,variables:A,validationData:F})}),r=await a.json();r.success?(alert(r.message||"\xa1Plantilla creada y enviada para revisi\xf3n!"),s.push("/dashboard/templates")):alert(r.error||"Error creando plantilla")}catch(e){console.error("Error creating template:",e),alert("Error de conexi\xf3n")}finally{_(!1)}},K=F?F.isValid||F.score>=70?F.score>=90?{icon:c.Z,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",title:"\xa1Plantilla Excelente!",subtitle:"Score: ".concat(F.score,"/100 - Alta probabilidad de aprobaci\xf3n")}:F.score>=80?{icon:c.Z,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",title:"Plantilla Aprobada",subtitle:"Score: ".concat(F.score,"/100 - Buena calidad")}:{icon:n.Z,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",title:"Plantilla Aceptable",subtitle:"Score: ".concat(F.score,"/100 - Puede necesitar mejoras")}:{icon:o.Z,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",title:"Plantilla No Aprobada",subtitle:"Score: ".concat(F.score,"/100 - Requiere cambios significativos")}:null;return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(v.z,{variant:"ghost",size:"sm",onClick:()=>s.push("/dashboard/templates"),children:[(0,r.jsx)(d.Z,{size:16,className:"mr-1"}),"Volver a Plantillas"]}),(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,r.jsx)(m.Z,{className:"w-6 h-6 mr-2 text-purple-600"}),"Nueva Plantilla con IA"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(N.Zb,{className:"bg-white",padding:"lg",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Informaci\xf3n de la Plantilla"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Plantilla *"}),(0,r.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ej: Confirmaci\xf3n de Cita M\xe9dica"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categor\xeda"}),(0,r.jsx)("select",{value:z,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[{value:"general",label:"General"},{value:"marketing",label:"Marketing"},{value:"medical",label:"M\xe9dica"},{value:"beauty",label:"Belleza"},{value:"service",label:"Servicios"},{value:"promotion",label:"Promocional"},{value:"reminder",label:"Recordatorios"}].map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contenido del Mensaje *"}),(0,r.jsx)("textarea",{value:Z,onChange:e=>S(e.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Hola {{nombre}}, le recordamos su cita el {{fecha}} a las {{hora}}..."}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Usa ","{{variable}}"," para campos din\xe1micos"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variables Din\xe1micas"}),(0,r.jsxs)("div",{className:"flex space-x-2 mb-2",children:[(0,r.jsx)("input",{type:"text",value:P,onChange:e=>D(e.target.value),onKeyPress:e=>"Enter"===e.key&&L(),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"nombre, fecha, hora..."}),(0,r.jsx)(v.z,{type:"button",onClick:L,size:"sm",children:(0,r.jsx)(x.Z,{size:16})})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:A.map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("button",{onClick:()=>J(a),className:"ml-2 text-blue-600 hover:text-blue-800",children:(0,r.jsx)(u.Z,{size:12})})]},a))})]})]})]}),(0,r.jsxs)(N.Zb,{className:"bg-white",padding:"lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Vista Previa"}),(0,r.jsxs)(v.z,{variant:"outline",size:"sm",onClick:()=>H(!B),children:[(0,r.jsx)(p.Z,{size:14,className:"mr-1"}),B?"Ocultar":"Ver"]})]}),B&&(0,r.jsx)("div",{className:"bg-gray-50 border rounded-lg p-4",children:(0,r.jsx)("div",{className:"bg-green-500 text-white px-4 py-2 rounded-lg max-w-xs",children:(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:(e=Z,A.forEach(a=>{let s={nombre:"Juan P\xe9rez",empresa:"Mi Empresa",servicio:"Consulta",fecha:"2024-01-15",hora:"14:30",precio:"$50,000",ubicacion:"Calle 123"}[a.toLowerCase()]||"[".concat(a,"]");e=e.replace(RegExp("{{".concat(a,"}}"),"g"),s)}),e)})})})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(N.Zb,{className:"bg-white",padding:"lg",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(h.Z,{className:"w-12 h-12 text-purple-600 mx-auto"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Validaci\xf3n con IA"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Valida tu plantilla contra las pol\xedticas de WhatsApp"})]}),(0,r.jsx)(v.z,{onClick:G,disabled:V||!k.trim()||!Z.trim(),className:"w-full bg-purple-600 hover:bg-purple-700",children:V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{className:"w-4 h-4 mr-2 animate-spin"}),"Validando con IA..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Validar con IA"]})})]})}),F&&K&&(0,r.jsx)(N.Zb,{className:"".concat(K.bgColor," ").concat(K.borderColor," border"),padding:"lg",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(K.icon,{className:"w-6 h-6 ".concat(K.color," mt-0.5")}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold ".concat(K.color),children:K.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:K.subtitle})]})]}),F.reasons&&Array.isArray(F.reasons)&&F.reasons.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Razones:"}),(0,r.jsx)("ul",{className:"list-disc list-inside space-y-1",children:F.reasons.map((e,a)=>(0,r.jsx)("li",{className:"text-sm text-gray-700",children:e},a))})]}),F.improvedTemplate&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-1"}),"\uD83D\uDCA1 Plantilla Mejorada por IA:"]}),(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4 space-y-3",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg p-3 shadow-sm",children:(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap font-medium",children:F.improvedTemplate})}),(0,r.jsx)("div",{className:"flex space-x-2",children:(0,r.jsx)(v.z,{size:"sm",className:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white",onClick:()=>{let e;S(F.improvedTemplate);let a=/\{\{(\w+)\}\}/g,s=[];for(;null!==(e=a.exec(F.improvedTemplate));)s.includes(e[1])||s.push(e[1]);E(s)},children:"✨ Usar Esta Versi\xf3n Mejorada"})})]})]}),F.suggestions&&F.suggestions.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,r.jsx)(j.Z,{className:"w-4 h-4 mr-1 text-amber-500"}),"Sugerencias para Mejorar:"]}),(0,r.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:(0,r.jsx)("ul",{className:"space-y-2",children:F.suggestions.map((e,a)=>(0,r.jsxs)("li",{className:"text-sm text-amber-900 flex items-start",children:[(0,r.jsx)("span",{className:"mr-2",children:"•"}),(0,r.jsx)("span",{children:e})]},a))})})]}),F.excelFormat&&F.excelFormat.columns&&F.excelFormat.columns.length>0&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5 mr-2 text-blue-600"}),"\uD83D\uDCCA Formato Requerido para tu Excel/CSV:"]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-blue-200",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-blue-100",children:[(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider",children:"Columna"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider",children:"Descripci\xf3n"}),(0,r.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold text-blue-900 uppercase tracking-wider",children:"Ejemplo"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-blue-100",children:F.excelFormat.columns.map((e,a)=>(0,r.jsxs)("tr",{className:a%2==0?"bg-white":"bg-blue-50/30",children:[(0,r.jsx)("td",{className:"px-4 py-2 text-sm font-medium text-gray-900",children:(0,r.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded text-blue-600",children:e.column})}),(0,r.jsx)("td",{className:"px-4 py-2 text-sm text-gray-700",children:e.description}),(0,r.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600 font-mono",children:e.example})]},a))})]})}),(0,r.jsx)("div",{className:"mt-3 p-3 bg-blue-100 rounded-lg",children:(0,r.jsxs)("p",{className:"text-xs text-blue-800 flex items-start",children:[(0,r.jsx)("span",{className:"mr-1",children:"\uD83D\uDCA1"}),(0,r.jsx)("span",{children:F.excelFormat.example||"La primera fila debe contener los nombres exactos de las columnas."})]})})]})]})]})}),F&&(0,r.jsxs)("div",{className:"space-y-4",children:[F.score>=90?(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-green-800 mb-3",children:["✅ \xa1Excelente! Tu plantilla tiene un score de ",F.score,"/100. Alta probabilidad de ser aprobada r\xe1pidamente."]})}):F.score>=80?(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-blue-800 mb-3",children:["\uD83D\uDC4D Buena plantilla con score de ",F.score,"/100. Ser\xe1 revisada manualmente antes de activarse."]})}):F.score>=70?(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-yellow-800 mb-3",children:["⚠️ Score de ",F.score,"/100. La plantilla es aceptable pero considera aplicar las sugerencias de la IA."]})}):(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("p",{className:"text-sm text-red-800 mb-3",children:["❌ Score bajo (",F.score,"/100). Se recomienda mejorar la plantilla antes de enviarla."]})}),(0,r.jsx)(v.z,{onClick:U,disabled:q,className:"w-full bg-primary-600 hover:bg-primary-700",children:q?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando para Revisi\xf3n..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Crear y Enviar para Revisi\xf3n"]})})]})]})]})]})}},32660:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(79205).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},49322:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(79205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},61649:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(79205).Z)("file-spreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]])},25846:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(79205).Z)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]])},83229:function(e,a,s){"use strict";s.d(a,{Z:function(){return r}});let r=(0,s(79205).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},function(e){e.O(0,[14,126,971,117,744],function(){return e(e.s=29924)}),_N_E=e.O()}]);