(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[478],{20067:function(){},72061:function(){},47761:function(e,s,a){Promise.resolve().then(a.bind(a,93253))},93253:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return K}});var t=a(57437),r=a(2265),l=a(99376),i=a(8530),n=a(95805),c=a(48736),o=a(44743),d=a(41671),m=a(11239),x=a(88906),p=a(91723),u=a(10407),h=a(53417),g=a(56426),j=a(66070),f=a(2093),b=a(61649),N=a(17689),v=a(87117),y=a(76865),w=a(22135),C=a(40875),z=a(32489),S=a(49322),Z=a(43863);function k(e){let{onDataProcessed:s,onContinue:a}=e,[l,i]=(0,r.useState)(null),[o,m]=(0,r.useState)({status:"idle",progress:0,message:""}),[u,h]=(0,r.useState)(!1),[k,E]=(0,r.useState)([]),[D,P]=(0,r.useState)([]),[T,V]=(0,r.useState)(0),[L,M]=(0,r.useState)(0),[q,I]=(0,r.useState)(!1),[A,F]=(0,r.useState)("24"),[R,O]=(0,r.useState)("24:00:00"),[_,U]=(0,r.useState)([]),[B,W]=(0,r.useState)([]),[H,Y]=(0,r.useState)(null);(0,r.useEffect)(()=>{if("complete"===o.status){let e=parseInt(A),s=0,a=0,t=setInterval(()=>{a>0?a--:s>0?(s--,a=59):e>0?(e--,s=59,a=59):(clearInterval(t),O("00:00:00")),O("".concat(String(e).padStart(2,"0"),":").concat(String(s).padStart(2,"0"),":").concat(String(a).padStart(2,"0")))},1e3);return()=>clearInterval(t)}},[o.status,A]);let G=(0,r.useCallback)(e=>{e.preventDefault(),h(!0)},[]),$=(0,r.useCallback)(e=>{e.preventDefault(),h(!1)},[]),J=e=>{let s=e.name.toLowerCase();return s.endsWith(".csv")?"csv":s.endsWith(".xlsx")||s.endsWith(".xls")?"excel":null},K=e=>["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)||[".csv",".xls",".xlsx"].some(s=>e.name.toLowerCase().endsWith(s)),Q=(0,r.useCallback)(e=>{e.preventDefault(),h(!1);let s=e.dataTransfer.files;if(s.length>0){let e=s[0];K(e)?ei(e):m({status:"error",progress:0,message:"Solo se aceptan archivos CSV (.csv) o Excel (.xlsx, .xls)"})}},[]),X=e=>{let s=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return["nombre","name","cliente","paciente","persona","contacto"].includes(s)?"nombre":["telefono","tel\xe9fono","phone","celular","movil","m\xf3vil","whatsapp","tel"].includes(s)?"telefono":["fecha","date","dia","d\xeda"].includes(s)?"fecha":["hora","time","horario","tiempo"].includes(s)?"hora":["doctor","medico","m\xe9dico","profesional","dr","dra"].includes(s)?"doctor":["consultorio","oficina","sala","ubicacion","ubicaci\xf3n","lugar"].includes(s)?"consultorio":["empresa","company","organizacion","organizaci\xf3n"].includes(s)?"empresa":s},ee=e=>{let s=Math.min(10,e.length),a=e.slice(0,s).filter(e=>e&&String(e).trim());return 0===a.length?"text":a.every(e=>/^[\+]?[0-9\-\s\(\)]{7,}$/.test(e))?"phone":a.every(e=>/^\d+(\.\d+)?$/.test(e))?"number":a.some(e=>/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(e))?"date":a.some(e=>/^\d{1,2}:\d{2}(:\d{2})?\s?(AM|PM|am|pm)?$/.test(e))?"time":"text"},es=e=>Math.round(e.filter(e=>e&&String(e).trim()).length/e.length*100),ea=e=>{if(0===e.length)return[];let s=e[0],a=[];return s.forEach((s,t)=>{let r=e.slice(1).map(e=>e[t]||""),l=X(s),i="telefono"===l?"phone":ee(r),n=es(r);a.push({original:s,mapped:l,type:i,completeness:n,required:"nombre"===l||"telefono"===l})}),a},et=e=>{let s=e.replace(/\D/g,"");return 10===s.length&&s.startsWith("3")&&(s="57"+s),s.startsWith("+")||(s="+"+s),s},er=e=>{let s=et(e);return/^\+57[0-9]{10}$/.test(s)||/^\+[0-9]{10,15}$/.test(s)},el=e=>{let s=",";return e.includes(";")&&e.split(";").length>e.split(",").length&&(s=";"),e.split(s).map(e=>e.trim().replace(/['"]/g,""))},ei=async e=>{i(e);let a=J(e);Y(a),m({status:"uploading",progress:0,message:"Subiendo archivo..."});for(let e=0;e<=100;e+=10)await new Promise(e=>setTimeout(e,100)),m(s=>({...s,progress:e}));"excel"===a&&(m({status:"processing",progress:0,message:"Leyendo archivo Excel..."}),await new Promise(e=>setTimeout(e,500)),m({status:"processing",progress:50,message:"Procesando hoja 1..."}),await new Promise(e=>setTimeout(e,500))),m({status:"validating",progress:100,message:"Validando datos..."});try{let a=[];if(e.name.toLowerCase().endsWith(".xlsx")||e.name.toLowerCase().endsWith(".xls")){let s=await e.arrayBuffer(),t=f.ij(s,{type:"array"}),r=t.SheetNames[0],l=t.Sheets[r];a=f.P6.sheet_to_json(l,{header:1})}else{let s=await e.text();console.log("File Content:",s.substring(0,200));let t=s.split(/\r?\n|\r/).filter(e=>e.trim());if(0===t.length){m({status:"error",progress:0,message:"El archivo est\xe1 vac\xedo"});return}a=t.map(e=>el(e))}if(0===a.length){m({status:"error",progress:0,message:"El archivo est\xe1 vac\xedo"});return}let t=ea(a);U(t),console.log("Column analysis:",t);let r=t.map(e=>e.original).join(", ");m({status:"processing",progress:100,message:"Detectamos ".concat(t.length," columnas: ").concat(r)}),await new Promise(e=>setTimeout(e,1e3));let l=t.some(e=>"nombre"===e.mapped),i=t.some(e=>"telefono"===e.mapped);if(!l||!i){let e=[];l||e.push("nombre"),i||e.push("telefono"),m({status:"error",progress:0,message:'El archivo debe tener columnas "'.concat(e.join('" y "'),'". Columnas encontradas: ').concat(r)});return}let n=t.map(e=>e.mapped);W(n);let c=t.find(e=>"nombre"===e.mapped),o=t.find(e=>"telefono"===e.mapped),d=t.indexOf(c),x=t.indexOf(o),p=[],u=[],h=0,g=0;m({status:"processing",progress:0,message:"Procesando contactos..."});for(let e=1;e<a.length;e++){let s=a[e].map(e=>String(e||"").trim()),r={nombre:s[d]||"",telefono:s[x]||""};t.forEach((e,a)=>{a!==d&&a!==x&&(r[e.mapped]=s[a]||"")});let l=!1;r.nombre||(u.push({row:e,field:"nombre",message:"Campo nombre est\xe1 vac\xedo"}),l=!0),r.telefono?er(r.telefono)?r.telefono=et(r.telefono):(u.push({row:e,field:"telefono",message:"N\xfamero telef\xf3nico inv\xe1lido (debe incluir c\xf3digo de pa\xeds)"}),l=!0):(u.push({row:e,field:"telefono",message:"Campo tel\xe9fono est\xe1 vac\xedo"}),l=!0),l?g++:h++,p.push(r);let i=Math.round(e/a.length*100);m(e=>({...e,progress:i})),await new Promise(e=>setTimeout(e,10))}E(p),P(u),V(h),M(g),console.log("CSV Uploader - calling onDataProcessed with:",{dataLength:p.length,columnsLength:t.length,columns:t.map(e=>({original:e.original,mapped:e.mapped}))}),null==s||s(p,t),0===u.length?m({status:"complete",progress:100,message:"Listo para enviar"}):m({status:"complete",progress:100,message:"Validaci\xf3n completada con errores"})}catch(s){console.error("Error processing file:",s);let e="Error al procesar el archivo. ";s instanceof Error&&(e="excel"===a?s.message.includes("password")||s.message.includes("protected")?"No se pudo leer el archivo Excel. Verifique que no est\xe9 protegido con contrase\xf1a.":s.message.includes("corrupt")||s.message.includes("invalid")?"Archivo Excel da\xf1ado o formato no compatible. Intente guardar como .xlsx nuevamente.":"Error al leer el archivo Excel. Verifique que sea un archivo v\xe1lido.":"csv"===a?s.message.includes("encoding")?"Problema de codificaci\xf3n detectado. Guarde el CSV con codificaci\xf3n UTF-8.":"Error al leer el archivo CSV. Verifique el formato y los delimitadores.":"Archivo da\xf1ado o formato no compatible. Solo se aceptan archivos CSV y Excel."),m({status:"error",progress:0,message:e})}},en=()=>{i(null),m({status:"idle",progress:0,message:""}),E([]),P([]),V(0),M(0),I(!1)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zb,{className:"bg-gradient-to-r from-primary-50 to-secondary-50 border-primary-200",padding:"lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(Z.Y,{icon:x.Z,className:"text-primary-600",size:24,animation:"pulse"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Sus datos est\xe1n seguros"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Procesamiento local - sin env\xedo a servidores externos"})]})]}),"complete"===o.status&&(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Eliminaci\xf3n autom\xe1tica en:"}),(0,t.jsx)("p",{className:"text-lg font-mono font-bold text-primary-600",children:R})]})]})}),"idle"===o.status&&(0,t.jsx)(j.Zb,{className:"border-2 border-dashed transition-all duration-300 ".concat(u?"border-primary-500 bg-primary-50 shadow-lg shadow-primary-500/20":"border-gray-300 hover:border-gray-400"),padding:"xl",children:(0,t.jsxs)("div",{onDragOver:G,onDragLeave:$,onDrop:Q,className:"text-center py-12 cursor-pointer",onClick:()=>{var e;return null===(e=document.getElementById("csv-input"))||void 0===e?void 0:e.click()},children:[(0,t.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[(0,t.jsxs)("div",{className:"transition-all duration-300 ".concat(u?"animate-pulse":""),children:[(0,t.jsx)(c.Z,{className:"".concat(u?"text-primary-600":"text-gray-400"),size:40}),(0,t.jsx)("span",{className:"text-xs text-gray-500 block text-center mt-1",children:"CSV"})]}),(0,t.jsxs)("div",{className:"transition-all duration-300 ".concat(u?"animate-pulse":""),children:[(0,t.jsx)(b.Z,{className:"".concat(u?"text-secondary-600":"text-gray-400"),size:40}),(0,t.jsx)("span",{className:"text-xs text-gray-500 block text-center mt-1",children:"Excel"})]})]}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Arrastra tu archivo CSV o Excel aqu\xed"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"o haz clic para seleccionar archivo"}),(0,t.jsxs)(g.z,{variant:"outline",size:"sm",className:"mx-auto",children:[(0,t.jsx)(c.Z,{className:"mr-2",size:16}),"Seleccionar Archivo"]}),(0,t.jsx)("input",{id:"csv-input",type:"file",accept:".csv,.xls,.xlsx",onChange:e=>{let s=e.target.files;if(s&&s.length>0){let e=s[0];K(e)?ei(e):m({status:"error",progress:0,message:"Solo se aceptan archivos CSV (.csv) o Excel (.xlsx, .xls)"})}},className:"hidden"}),(0,t.jsxs)("div",{className:"mt-6 text-xs text-gray-500",children:[(0,t.jsx)("p",{children:"M\xe1ximo: 10MB • Hasta 10,000 contactos"}),(0,t.jsx)("p",{children:"Formatos soportados: CSV, Excel (.xlsx, .xls)"}),(0,t.jsx)("p",{children:'Columnas requeridas: "nombre" y "telefono"'}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mt-2",children:[(0,t.jsxs)("a",{href:"/sample-contacts.csv",download:"contactos-ejemplo.csv",className:"inline-flex items-center text-primary-600 hover:text-primary-700 font-medium",children:[(0,t.jsx)(c.Z,{className:"mr-1",size:14}),"Descargar ejemplo (CSV)"]}),(0,t.jsxs)("button",{onClick:()=>{let e=f.P6.book_new(),s=f.P6.aoa_to_sheet([["nombre","telefono","fecha","hora","doctor","consultorio"],["Juan P\xe9rez","3001234567","2024-01-15","14:30","Dr. Gonz\xe1lez","Consulta 101"],["Mar\xeda Garc\xeda","+573109876543","2024-01-16","10:00","Dra. L\xf3pez","Consulta 205"],["Carlos Rodr\xedguez","300-555-1234","2024-01-17","16:15","Dr. Mart\xednez","Consulta 103"],["Ana Mart\xednez","(310) 222 3456","2024-01-18","09:45","Dra. Hern\xe1ndez","Consulta 201"],["Luis Gonz\xe1lez","3157894561","2024-01-19","11:30","Dr. S\xe1nchez","Consulta 107"],["Sofia L\xf3pez","+573204567890","2024-01-22","13:00","Dra. Torres","Consulta 208"],["Pedro S\xe1nchez","318 765 4321","2024-01-23","15:20","Dr. Ram\xedrez","Consulta 105"],["Laura Torres","3001112233","2024-01-24","08:30","Dra. Flores","Consulta 203"],["Diego Ram\xedrez","+573119998877","2024-01-25","17:00","Dr. Castro","Consulta 109"],["Carmen Flores","3226667788","2024-01-26","12:15","Dra. Morales","Consulta 206"]]);f.P6.book_append_sheet(e,s,"Contactos"),f.NC(e,"contactos-ejemplo.xlsx")},className:"inline-flex items-center text-primary-600 hover:text-primary-700 font-medium",children:[(0,t.jsx)(c.Z,{className:"mr-1",size:14}),"Descargar ejemplo (Excel)"]})]})]})]})}),("uploading"===o.status||"validating"===o.status||"processing"===o.status)&&(0,t.jsx)(j.Zb,{className:"bg-white",padding:"xl",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:["uploading"===o.status&&(0,t.jsx)(Z.Y,{icon:N.Z,className:"text-primary-600",animation:"pulse"}),"validating"===o.status&&(0,t.jsx)(Z.Y,{icon:v.Z,className:"text-primary-600",animation:"spin"}),"processing"===o.status&&(0,t.jsx)(Z.Y,{icon:n.Z,className:"text-primary-600",animation:"pulse"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:o.message})]}),(0,t.jsxs)("span",{className:"text-sm font-mono text-gray-600",children:[o.progress,"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(o.progress,"%")}})})]})}),"complete"===o.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Zb,{className:"bg-white",padding:"lg",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"inline-flex items-center space-x-2 text-green-600 mb-2",children:[(0,t.jsx)(d.Z,{size:24}),(0,t.jsxs)("span",{className:"text-lg font-semibold",children:["✅ ",k.length," contactos cargados exitosamente"]})]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["\uD83D\uDCCA Datos detectados: ",_.map(e=>e.original).join(", ")]}),(0,t.jsx)("p",{className:"text-primary-600 font-medium mt-2",children:"\uD83C\uDFAF Listo para seleccionar plantilla y mapear variables"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,t.jsx)(d.Z,{className:"text-green-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Datos completos"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:["✅ ",T]})]})]}),L>0&&(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,t.jsx)(y.Z,{className:"text-yellow-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Campos opcionales vac\xedos"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:["⚠️ ",L]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"(usar\xe1n valores por defecto)"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,t.jsx)(b.Z,{className:"text-blue-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Archivo"}),(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900 truncate",children:[null==l?void 0:l.name," (",null==H?void 0:H.toUpperCase(),")"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-purple-100",children:(0,t.jsx)(n.Z,{className:"text-purple-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Columnas detectadas"}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-900",children:_.length})]})]})]})]})}),(0,t.jsxs)(j.Zb,{className:"bg-gradient-to-r from-primary-50 to-secondary-50 border-primary-200",padding:"lg",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Variables disponibles para sus plantillas"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:_.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.completeness>95?"bg-green-500":e.completeness>70?"bg-yellow-500":"bg-red-500")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:"{".concat(e.mapped,"}")}),(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",e.original,")"]})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("span",{className:"text-sm font-medium ".concat(e.completeness>95?"text-green-600":e.completeness>70?"text-yellow-600":"text-red-600"),children:[e.completeness>95?"✅":e.completeness>70?"⚠️":"❌"," ",e.completeness,"%"]})})]},s))}),(0,t.jsx)("p",{className:"text-sm text-gray-600 text-center",children:"Estas variables estar\xe1n disponibles para sus plantillas de WhatsApp"})]})]}),(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Vista previa de datos"}),(0,t.jsx)(g.z,{variant:"ghost",size:"sm",onClick:()=>I(!q),children:q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Z,{className:"mr-2",size:16}),"Ocultar"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.Z,{className:"mr-2",size:16}),"Ver todos los ",k.length," contactos"]})})]}),(0,t.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Mostrando primeras ",Math.min(5,k.length)," filas con ",(0,t.jsx)("strong",{children:"TODAS"})," las columnas detectadas:"]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-gray-500",children:[(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),(0,t.jsx)("span",{children:"Tel\xe9fono"})]}),(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-400"}),(0,t.jsx)("span",{children:"Fecha"})]}),(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-purple-400"}),(0,t.jsx)("span",{children:"Hora"})]}),(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-orange-400"}),(0,t.jsx)("span",{children:"N\xfamero"})]}),(0,t.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400"}),(0,t.jsx)("span",{children:"Texto"})]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"#"}),_.map((e,s)=>(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("span",{children:e.original}),(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("phone"===e.type?"bg-blue-400":"date"===e.type?"bg-green-400":"time"===e.type?"bg-purple-400":"number"===e.type?"bg-orange-400":"bg-gray-400"),title:"Tipo: ".concat(e.type)})]})},s)),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.slice(0,q?k.length:5).map((e,s)=>{let a=D.some(e=>e.row===s+1);return(0,t.jsxs)("tr",{className:a?"bg-red-50":"",children:[(0,t.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:s+1}),_.map((s,a)=>(0,t.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm ".concat("phone"===s.type?"font-mono":""," text-gray-900"),children:e[s.mapped]||(0,t.jsx)("span",{className:"text-gray-400 italic",children:"vac\xedo"})},a)),(0,t.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:a?(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,t.jsx)(z.Z,{size:12,className:"mr-1"}),"Error"]}):(0,t.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,t.jsx)(d.Z,{size:12,className:"mr-1"}),"V\xe1lido"]})})]},s)})})]})})]}),D.length>0&&(0,t.jsx)(j.Zb,{className:"bg-red-50 border-red-200",padding:"lg",children:(0,t.jsxs)("div",{className:"mb-4 flex items-start space-x-3",children:[(0,t.jsx)(S.Z,{className:"text-red-600 flex-shrink-0",size:20}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"font-semibold text-red-900 mb-2",children:["Errores de validaci\xf3n (",D.length,")"]}),(0,t.jsxs)("ul",{className:"space-y-1 text-sm text-red-700",children:[D.slice(0,5).map((e,s)=>(0,t.jsxs)("li",{children:["Fila ",e.row,": ",e.message]},s)),D.length>5&&(0,t.jsxs)("li",{className:"font-medium",children:["... y ",D.length-5," errores m\xe1s"]})]})]})]})}),(0,t.jsx)(j.Zb,{className:"bg-gray-50",padding:"lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(p.Z,{className:"text-gray-600",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"retention",className:"font-medium text-gray-900",children:"Eliminar datos en:"}),(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"NUNCA almacenamos datos permanentemente"})]})]}),(0,t.jsxs)("select",{id:"retention",value:A,onChange:e=>F(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,t.jsx)("option",{value:"1",children:"1 hora despu\xe9s del env\xedo"}),(0,t.jsx)("option",{value:"12",children:"12 horas despu\xe9s del env\xedo"}),(0,t.jsx)("option",{value:"24",children:"24 horas despu\xe9s del env\xedo"}),(0,t.jsx)("option",{value:"48",children:"48 horas despu\xe9s del env\xedo"})]})]})}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[T>0&&(0,t.jsxs)(g.z,{size:"lg",className:"flex-1 gradient-primary cta-glow",onClick:a,children:["Continuar al env\xedo (",T," contactos)"]}),(0,t.jsxs)(g.z,{size:"lg",variant:"outline",onClick:en,className:"flex-1",children:[(0,t.jsx)(N.Z,{className:"mr-2",size:20}),"Cargar otro archivo"]})]})]}),"error"===o.status&&(0,t.jsx)(j.Zb,{className:"bg-red-50 border-red-200",padding:"lg",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(S.Z,{className:"text-red-600 flex-shrink-0",size:24}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-red-900 mb-2",children:"Error al procesar archivo"}),(0,t.jsx)("p",{className:"text-red-700",children:o.message}),(0,t.jsx)(g.z,{variant:"outline",size:"sm",onClick:en,className:"mt-4",children:"Intentar de nuevo"})]})]})})]})}var E=a(33276),D=a(82023),P=a(82222),T=a(41217),V=a(42208);function L(e){let{onSelectTemplate:s,selectedTemplate:a}=e,[l,i]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[o,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{p()},[]);let p=async()=>{try{c(!0);let e=localStorage.getItem("token"),s=await fetch("".concat("http://localhost:3005","/api/templates-ai/approved"),{headers:{Authorization:"Bearer ".concat(e)}}),a=await s.json();a.success&&i(a.templates)}catch(e){console.error("Error fetching campaign templates:",e)}finally{c(!1)}},f=e=>"active"===e.status?{icon:E.Z,color:"text-secondary-600",bgColor:"bg-secondary-50",borderColor:"border-secondary-200",text:"\uD83D\uDE80 Activa",description:"Lista para campa\xf1as"}:{icon:d.Z,color:"text-primary-600",bgColor:"bg-primary-50",borderColor:"border-primary-200",text:"✅ Aprobada",description:"Pendiente de activaci\xf3n"},b=e=>["recordatorio_citas","confirmacion_citas"].includes(e);return n?(0,t.jsx)(j.Zb,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-lg",padding:"lg",children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-dark-600",children:"Cargando plantillas disponibles..."})]})}):0===l.length?(0,t.jsx)(j.Zb,{className:"bg-gradient-to-br from-primary-50 to-secondary-50/30 border-primary-200 shadow-lg",padding:"lg",children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsxs)("div",{className:"relative mb-6",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-primary-500/10 blur-2xl rounded-full"}),(0,t.jsx)(Z.Y,{icon:h.Z,size:80,className:"text-primary-400 mx-auto relative",animation:"pulse"})]}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-primary-800 mb-3",children:"\uD83C\uDF1F \xa1No hay plantillas disponibles!"}),(0,t.jsx)("p",{className:"text-primary-600 max-w-md mx-auto mb-6 leading-relaxed",children:"No se encontraron plantillas activas para usar en campa\xf1as."})]})}):(0,t.jsxs)(j.Zb,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-lg",padding:"lg",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(Z.Y,{icon:D.Z,size:28,className:"text-secondary-600",animation:"pulse"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent",children:"Plantillas Disponibles"}),(0,t.jsxs)("p",{className:"text-dark-500 text-sm",children:[l.length," plantilla",1!==l.length?"s":""," disponible",1!==l.length?"s":""," para campa\xf1as"]})]})]})}),(0,t.jsx)("div",{className:"grid gap-4",children:l.map(e=>{let r=f(e),l=(null==a?void 0:a.id)===e.id,i=o===e.id,n=b(e.name);return(0,t.jsxs)("div",{className:"group border-2 rounded-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1 ".concat(l?"border-primary-400 bg-gradient-to-r from-primary-50 to-secondary-50 shadow-lg scale-105":"border-light-200 bg-white hover:border-primary-200 hover:shadow-md"),children:[(0,t.jsx)("div",{className:"p-6",onClick:()=>{s(e),x(i?null:e.id)},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-0 ".concat(r.color.replace("text-","bg-").replace("-600","-500/20")," blur-md rounded-full")}),(0,t.jsx)(Z.Y,{icon:r.icon,size:32,className:"".concat(r.color," relative"),animation:"pulse"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("h3",{className:"text-lg font-bold transition-colors duration-300 ".concat(l?"text-primary-700":"text-dark-800 group-hover:text-primary-600"),children:e.name}),n&&(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:"\uD83C\uDFE2 Sistema"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3 mt-1",children:[(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(r.bgColor," ").concat(r.color," border ").concat(r.borderColor),children:r.text}),(0,t.jsx)("span",{className:"text-xs text-dark-500",children:r.description}),e.aiScore&&(0,t.jsxs)("div",{className:"flex items-center space-x-1 px-2 py-1 bg-secondary-100 text-secondary-700 rounded text-xs",children:[(0,t.jsx)(P.Z,{className:"w-3 h-3"}),(0,t.jsxs)("span",{children:[e.aiScore,"/100"]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"text-sm text-dark-600 flex items-center space-x-2 bg-light-100 px-3 py-2 rounded-lg",children:[(0,t.jsx)(T.Z,{className:"w-4 h-4 text-primary-500"}),(0,t.jsxs)("span",{className:"font-medium",children:[e.variables.length," variables"]})]}),(0,t.jsx)(u.Z,{className:"w-6 h-6 transition-all duration-300 ".concat(l?"text-primary-600 rotate-90":"text-dark-400 group-hover:text-primary-600")})]})]})}),i&&(0,t.jsxs)("div",{className:"border-t border-light-200 bg-gradient-to-br from-light-50 to-white p-6 animate-slide-down",children:[(0,t.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold text-dark-800 mb-3 flex items-center",children:[(0,t.jsx)(h.Z,{className:"w-4 h-4 mr-2 text-primary-600"}),"Vista Previa del Mensaje"]}),(0,t.jsxs)("div",{className:"bg-white border-2 border-light-200 rounded-lg p-4 shadow-inner",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-primary-500 to-secondary-500 w-8 h-1 rounded-full mb-3"}),(0,t.jsx)("p",{className:"text-dark-700 whitespace-pre-wrap leading-relaxed text-sm",children:e.content}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-light-100",children:[(0,t.jsxs)("div",{className:"text-xs text-dark-400",children:[e.content.length," caracteres"]}),e.twilioSid&&(0,t.jsxs)("div",{className:"text-xs text-primary-600 font-medium bg-primary-50 px-2 py-1 rounded",children:["SID: ",e.twilioSid]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold text-dark-800 mb-3 flex items-center",children:[(0,t.jsx)(T.Z,{className:"w-4 h-4 mr-2 text-secondary-600"}),"Variables Requeridas"]}),e.variables.length>0?(0,t.jsxs)("div",{className:"space-y-2",children:[e.variables.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center space-x-2 bg-secondary-50 border border-secondary-200 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-secondary-500 rounded-full"}),(0,t.jsx)("span",{className:"font-medium text-secondary-800",children:"{{".concat(e,"}}")})]},s)),(0,t.jsx)("div",{className:"mt-4 p-3 bg-accent-50 border border-accent-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-accent-700 text-sm",children:[(0,t.jsx)(m.Z,{className:"w-4 h-4 inline mr-1"}),"Tu archivo CSV debe incluir columnas para todas estas variables."]})})]}):(0,t.jsxs)("div",{className:"text-center py-6 bg-light-50 rounded-lg border-2 border-dashed border-light-300",children:[(0,t.jsx)(d.Z,{className:"w-8 h-8 text-secondary-500 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-dark-600 font-medium",children:"Sin variables"}),(0,t.jsx)("p",{className:"text-dark-500 text-sm",children:"Esta plantilla no requiere datos adicionales"})]})]})]}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-light-200",children:(0,t.jsx)(g.z,{onClick:()=>s(e),className:"w-full py-4 text-lg font-semibold transition-all duration-300 transform hover:scale-105 ".concat(l?"bg-gradient-to-r from-secondary-500 to-secondary-600 hover:from-secondary-600 hover:to-secondary-700 text-white shadow-lg":"bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white shadow-lg hover:shadow-xl"),children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{className:"w-6 h-6 mr-3"}),"✨ Plantilla Seleccionada"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.Z,{className:"w-6 h-6 mr-3"}),"\uD83D\uDE80 Usar Esta Plantilla"]})})})]})]},e.id)})}),(0,t.jsx)("div",{className:"mt-6 p-4 bg-gradient-to-r from-primary-50 to-secondary-50 border border-primary-200 rounded-xl",children:(0,t.jsxs)("p",{className:"text-primary-700 text-sm font-medium flex items-center",children:[(0,t.jsx)(D.Z,{className:"w-4 h-4 mr-2"}),"\uD83D\uDCA1 Las plantillas del sistema est\xe1n disponibles para todos los usuarios. Las plantillas personales solo son visibles para ti."]})})]})}var M=a(98728),q=a(82431),I=a(33388),A=a(58896);let F=e=>{let s;let a=/\{([^}]+)\}/g,t=[];for(;null!==(s=a.exec(e));){let e=s[1].trim();e&&!t.includes(e)&&t.push(e)}return t.sort()};function R(e){let{template:s,availableColumns:a,csvData:l,onVariableMapping:i,onDefaultValues:c}=e,[o,m]=(0,r.useState)(0),[x,u]=(0,r.useState)({}),[f,b]=(0,r.useState)({}),[N,v]=(0,r.useState)(!1),w=s?F(s.preview):[],[C,z]=(0,r.useState)({});if((0,r.useEffect)(()=>{if(!s)return;let e={},a={},t={};w.forEach(e=>{if(C[e]){t[e]=C[e];return}t[e]="default",e.toLowerCase().includes("fecha")?a[e]=new Date().toISOString().split("T")[0]:e.toLowerCase().includes("hora")?a[e]="09:00":a[e]=""}),u(s=>({...s,...e})),b(e=>({...e,...a})),z(e=>({...e,...t}))},[null==s?void 0:s.id,a.length]),!s)return(0,t.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-50 rounded-lg",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(h.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Seleccione una plantilla"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Elija una plantilla de la biblioteca para ver la vista previa"}),a.length>0&&(0,t.jsxs)("p",{className:"text-sm text-blue-600 mt-2",children:[a.length," columnas detectadas: ",a.map(e=>e.original).join(", ")]})]})});let S=(e,s)=>{if(z(a=>({...a,[e]:s})),"default"===s){let s={...x};if(delete s[e],u(s),null==i||i(s),!f[e]){let s={...f};e.toLowerCase().includes("fecha")?s[e]=new Date().toISOString().split("T")[0]:e.toLowerCase().includes("hora")?s[e]="09:00":s[e]="",b(s),null==c||c(s)}}else{let s={...f};delete s[e],b(s),null==c||c(s)}},Z=(e,s)=>{let a={...x,[e]:s};u(a),null==i||i(a)},k=(e,s)=>{let a={...f,[e]:s};b(a),null==c||c(a)},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;if(!s)return"";if(0===l.length)return s.preview;let a=l[e]||l[0],t=s.preview;return w.forEach(e=>{let s=x[e],r=f[e],l="";l=s&&a[s]?a[s]:r&&""!==r.trim()?r:"{".concat(e,"}"),t=t.replace(RegExp("\\{".concat(e,"\\}"),"g"),l)}),t}(),D=E.length,P=D>4096,T=l.filter(e=>w.every(s=>{if("csv"===C[s]){let a=x[s];return a&&e[a]&&""!==e[a].trim()}{let e=f[s];return e&&""!==e.trim()}})).length,L=l.length-T;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zb,{className:"bg-gradient-to-r from-primary-50 to-secondary-50 border-primary-200",padding:"lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:s.name}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:s.description})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Usada ",s.usageCount.toLocaleString()," veces"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,t.jsx)(n.Z,{size:16,className:"text-primary-600"}),(0,t.jsxs)("span",{className:"text-primary-600 font-medium",children:[T," compatibles"]}),(0,t.jsxs)("span",{className:"text-blue-600 text-sm",children:["(",Object.values(C).filter(e=>"csv"===e).length," CSV + ",Object.values(C).filter(e=>"default"===e).length," defecto)"]})]})]})]})}),(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(M.Z,{size:20,className:"mr-2"}),"Configuraci\xf3n de Variables"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Para cada variable, elige si usar una ",(0,t.jsx)("strong",{children:"columna de tu archivo CSV"})," o un ",(0,t.jsx)("strong",{children:"valor por defecto"}),":"]}),w.map(e=>{let s=C[e]||"default",r=x[e],l=a.find(e=>e.mapped===r),i=e.toLowerCase().includes("fecha"),n=e.toLowerCase().includes("hora");return(0,t.jsxs)("div",{className:"border rounded-lg p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("code",{className:"text-lg font-medium text-primary-600 bg-primary-100 px-3 py-1 rounded",children:"{".concat(e,"}")}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Usar:"}),(0,t.jsxs)("select",{value:s,onChange:s=>S(e,s.target.value),className:"px-3 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm font-medium",children:[(0,t.jsx)("option",{value:"csv",children:"\uD83D\uDCC1 Columna CSV"}),(0,t.jsx)("option",{value:"default",children:"✏️ Valor por defecto"})]})]})]}),"csv"===s?(0,t.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("span",{className:"text-sm text-blue-700 font-medium min-w-0 flex-shrink-0",children:"Mapear a columna:"}),(0,t.jsxs)("select",{value:r||"",onChange:s=>Z(e,s.target.value),className:"flex-1 px-3 py-2 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"",children:"Seleccionar columna..."}),a.map(e=>(0,t.jsxs)("option",{value:e.mapped,children:[e.original," (",e.completeness,"% completo)"]},e.mapped))]}),(0,t.jsx)("div",{className:"flex items-center",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{size:16,className:"text-green-600"}),(0,t.jsxs)("span",{className:"text-xs text-green-600 ml-1",children:[l.completeness,"%"]})]}):(0,t.jsx)(y.Z,{size:16,className:"text-amber-600"})})]})}):(0,t.jsx)("div",{className:"bg-orange-50 p-3 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("span",{className:"text-sm text-orange-700 font-medium min-w-0 flex-shrink-0",children:"Valor por defecto:"}),i?(0,t.jsx)("input",{type:"date",value:f[e]||"",onChange:s=>k(e,s.target.value),className:"flex-1 px-3 py-2 border border-orange-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500"}):n?(0,t.jsx)("input",{type:"time",value:f[e]||"",onChange:s=>k(e,s.target.value),className:"flex-1 px-3 py-2 border border-orange-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500"}):(0,t.jsx)("input",{type:"text",placeholder:"Ej: ".concat("servicio"===e?"Manicure, Pedicure, Corte...":"Ingrese valor..."),value:f[e]||"",onChange:s=>k(e,s.target.value),className:"flex-1 px-3 py-2 border border-orange-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500"}),(0,t.jsx)("div",{className:"flex items-center",children:f[e]&&""!==f[e].trim()?(0,t.jsx)(d.Z,{size:16,className:"text-green-600"}):(0,t.jsx)(y.Z,{size:16,className:"text-gray-400"})})]})})]},e)}),(0,t.jsx)("div",{className:"border-t pt-4 mt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:["Variables detectadas: ",(0,t.jsx)("strong",{children:w.length})]}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsxs)("span",{className:"text-blue-600",children:["\uD83D\uDCC1 CSV: ",Object.values(C).filter(e=>"csv"===e).length]}),(0,t.jsxs)("span",{className:"text-orange-600",children:["✏️ Por defecto: ",Object.values(C).filter(e=>"default"===e).length]})]})]})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h4",{className:"font-semibold text-gray-900 flex items-center",children:[(0,t.jsx)(V.Z,{size:20,className:"mr-2"}),"Vista Previa"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("select",{value:o,onChange:e=>m(Number(e.target.value)),className:"text-sm px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500",children:l.slice(0,5).map((e,s)=>(0,t.jsx)("option",{value:s,children:e.nombre||"Contacto ".concat(s+1)},s))}),(0,t.jsx)(g.z,{variant:"ghost",size:"sm",onClick:()=>m(e=>e>=l.length-1?0:e+1),children:(0,t.jsx)(q.Z,{size:16})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border",children:(0,t.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:E})}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Caracteres:"}),(0,t.jsxs)("span",{className:"font-medium ".concat(P?"text-red-600":D>3500?"text-yellow-600":"text-green-600"),children:[D," / 4,096"]})]}),P&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-red-800 text-sm",children:"⚠️ El mensaje excede el l\xedmite de caracteres de WhatsApp"})})]})]}),(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(I.Z,{size:20,className:"mr-2"}),"As\xed se ver\xe1 en WhatsApp"]}),(0,t.jsx)("div",{className:"bg-gradient-to-b from-green-400 to-green-500 p-4 rounded-t-2xl",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 text-white",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:(0,t.jsx)(n.Z,{size:16})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Su Empresa"}),(0,t.jsx)("p",{className:"text-xs opacity-75",children:"en l\xednea"})]})]})}),(0,t.jsx)("div",{className:"bg-green-50 p-4 min-h-[200px] rounded-b-2xl",children:(0,t.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-sm max-w-[80%] ml-auto",children:[(0,t.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:E}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2 text-right",children:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})})]})]}),(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsxs)("h4",{className:"font-semibold text-gray-900 mb-4 flex items-center",children:[(0,t.jsx)(A.Z,{size:20,className:"mr-2"}),"Resumen de Compatibilidad"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,t.jsx)(d.Z,{className:"text-green-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Datos completos"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:["✅ ",T]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-purple-100",children:(0,t.jsx)(M.Z,{className:"text-purple-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Variables configuradas"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:["⚙️ ",w.length]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["(",Object.values(C).filter(e=>"csv"===e).length," CSV + ",Object.values(C).filter(e=>"default"===e).length," defecto)"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,t.jsx)(p.Z,{className:"text-blue-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Tiempo estimado"}),(0,t.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:[Math.ceil(l.length/60)," min"]})]})]})]}),L>0&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,t.jsx)("strong",{children:"Nota:"})," ",L," contactos usar\xe1n valores por defecto para variables faltantes. Para mejor resultado, considere agregar las columnas faltantes a su archivo."]})})]})]})}var O=a(64972),_=a(76858);function U(e){let{availableColumns:s,templates:a,onTemplateRecommend:l,onCustomTemplateRequest:i}=e,[n,c]=(0,r.useState)(!1),[m,x]=(0,r.useState)([]),[p,u]=(0,r.useState)(""),[h,j]=(0,r.useState)(!1),[f,b]=(0,r.useState)("welcome"),N=(0,r.useRef)(null),v=()=>{var e;null===(e=N.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{v()},[m]),(0,r.useEffect)(()=>{n&&0===m.length&&k()},[n]);let y=(e,s,a)=>{let t={id:Date.now().toString(),type:s,content:e,timestamp:new Date,...a};x(e=>[...e,t])},w=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500;j(!0),await new Promise(s=>setTimeout(s,e)),j(!1)},C=()=>{let e=s.map(e=>e.mapped),a="",t=0;return e.some(e=>["doctor","medico","consultorio","paciente"].includes(e))?(a="salud",t=95):e.some(e=>["servicio","hora","fecha","cita"].includes(e))?(a="servicios",t=80):e.some(e=>["producto","precio","descuento"].includes(e))?(a="retail",t=75):e.some(e=>["mesa","personas","reserva"].includes(e))&&(a="restaurantes",t=85),{detectedIndustry:a,confidence:t,columnNames:e}},S=()=>a.filter(e=>e.compatibility>=70).sort((e,s)=>s.compatibility-e.compatibility).slice(0,3),k=async()=>{await w(1e3),y("Hola, soy su asistente de plantillas. He analizado su archivo CSV y puedo ayudarle a encontrar la plantilla perfecta para sus necesidades.","ai"),setTimeout(async()=>{let e=C();await w(1200),y("Detect\xe9 que tiene datos de: ".concat(e.columnNames.join(", "),". Esto me da una buena idea de qu\xe9 tipo de comunicaci\xf3n necesita."),"ai"),setTimeout(async()=>{await w(1e3),e.detectedIndustry&&e.confidence>70?(y("Basado en sus columnas, parece que trabaja en ".concat({salud:"sector de salud",servicios:"servicios profesionales",retail:"comercio retail",restaurantes:"restaurantes"}[e.detectedIndustry],". \xbfEs correcto?"),"ai",{action:"industry_analysis"}),b("industry")):(y("\xbfPara qu\xe9 tipo de comunicaci\xf3n usar\xe1 estos datos? Por ejemplo: recordatorios de citas, promociones, confirmaciones, etc.","ai"),b("analysis"))},2e3)},2e3)},E=async e=>{if(e){y("S\xed, es correcto","user"),await w(1e3);let e=S();y("Perfecto. He encontrado ".concat(e.length," plantillas altamente compatibles con sus datos. Le recomiendo estas opciones:"),"ai",{templates:e,action:"recommend_template"})}else y("No, trabajo en otro sector","user"),await w(1e3),y("Entendido. \xbfPuede contarme m\xe1s sobre su negocio y qu\xe9 tipo de mensajes necesita enviar?","ai");b("recommendations")},P=async()=>{p.trim()&&(y(p.trim(),"user"),u(""),await w(1200),"analysis"===f?(y("Entiendo. Basado en su descripci\xf3n y los datos disponibles, estas son mis recomendaciones:","ai",{templates:S(),action:"recommend_template"}),b("recommendations")):"recommendations"===f?(y("Gracias por la informaci\xf3n adicional. \xbfLe gustar\xeda que revise alguna plantilla espec\xedfica o prefiere que dise\xf1e una plantilla personalizada para sus necesidades exactas?","ai",{action:"custom_template"}),b("custom")):y("Entiendo. \xbfHay algo m\xe1s en lo que pueda ayudarle con las plantillas?","ai"))},T=()=>{y("Me interesa una plantilla personalizada","user"),i()};return n?(0,t.jsxs)("div",{className:"fixed bottom-6 right-6 w-96 h-[600px] bg-white rounded-2xl shadow-2xl border z-50 flex flex-col animate-slide-up",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 p-4 rounded-t-2xl flex items-center justify-between text-white",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(Z.Y,{icon:O.Z,size:24,animation:"pulse"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Asistente IA"}),(0,t.jsx)("p",{className:"text-xs opacity-75",children:"Plantillas inteligentes"})]})]}),(0,t.jsx)(g.z,{variant:"ghost",size:"sm",onClick:()=>c(!1),className:"text-white hover:bg-white/20 p-1",children:(0,t.jsx)(z.Z,{size:20})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[m.map(e=>(0,t.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"max-w-[80%] p-3 rounded-2xl ".concat("user"===e.type?"bg-primary-600 text-white":"bg-white text-gray-800 shadow-sm border"),children:[(0,t.jsx)("p",{className:"text-sm",children:e.content}),e.templates&&e.templates.length>0&&(0,t.jsx)("div",{className:"mt-3 space-y-2",children:e.templates.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 text-sm",children:e.name}),(0,t.jsxs)("span",{className:"text-xs text-green-600 font-medium",children:[e.compatibility,"% compatible"]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),(0,t.jsxs)(g.z,{size:"sm",onClick:()=>l(e),className:"w-full text-xs",children:["Usar esta plantilla",(0,t.jsx)(_.Z,{size:12,className:"ml-1"})]})]},e.id))}),"industry_analysis"===e.action&&(0,t.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,t.jsxs)(g.z,{size:"sm",onClick:()=>E(!0),className:"flex-1 text-xs",children:[(0,t.jsx)(d.Z,{size:12,className:"mr-1"}),"S\xed"]}),(0,t.jsx)(g.z,{size:"sm",variant:"outline",onClick:()=>E(!1),className:"flex-1 text-xs",children:"No"})]}),"custom_template"===e.action&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)(g.z,{size:"sm",onClick:T,className:"w-full text-xs bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:[(0,t.jsx)(D.Z,{size:12,className:"mr-1"}),"Plantilla personalizada"]})}),(0,t.jsx)("p",{className:"text-xs opacity-50 mt-2",children:e.timestamp.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})},e.id)),h&&(0,t.jsx)("div",{className:"flex justify-start",children:(0,t.jsx)("div",{className:"bg-white text-gray-800 p-3 rounded-2xl shadow-sm border max-w-[80%]",children:(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-75"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-150"})]})})}),(0,t.jsx)("div",{ref:N})]}),(0,t.jsx)("div",{className:"p-4 border-t bg-white rounded-b-2xl",children:(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("input",{type:"text",value:p,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&P(),placeholder:"Escriba su mensaje...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm text-gray-900",disabled:h}),(0,t.jsx)(g.z,{onClick:P,disabled:!p.trim()||h,size:"sm",className:"px-3",children:(0,t.jsx)(o.Z,{size:16})})]})})]}):(0,t.jsxs)("div",{className:"fixed bottom-6 right-6 z-50",children:[(0,t.jsx)(g.z,{onClick:()=>c(!0),className:"rounded-full w-14 h-14 bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 shadow-lg hover:shadow-xl transition-all duration-300 group",children:(0,t.jsx)(Z.Y,{icon:O.Z,size:24,className:"text-white group-hover:scale-110",animation:"pulse"})}),(0,t.jsxs)("div",{className:"absolute bottom-16 right-0 bg-gray-900 text-white px-3 py-2 rounded-lg text-sm whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",children:["Asistente IA",(0,t.jsx)("div",{className:"absolute top-full right-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]})}let B=[{id:"recordatorio",name:"Recordatorio de cita",description:"Para recordar citas o servicios programados"},{id:"confirmacion",name:"Confirmaci\xf3n",description:"Para confirmar reservas o pedidos"},{id:"promocion",name:"Promoci\xf3n",description:"Para ofertas y descuentos especiales"},{id:"notificacion",name:"Notificaci\xf3n",description:"Para avisos importantes o actualizaciones"},{id:"seguimiento",name:"Seguimiento",description:"Para hacer seguimiento post-servicio"},{id:"bienvenida",name:"Bienvenida",description:"Para nuevos clientes o usuarios"},{id:"personalizado",name:"Personalizado",description:"Tipo de mensaje espec\xedfico"}],W=[{id:"formal",name:"Formal",description:"Lenguaje profesional y cort\xe9s",example:"Estimado/a [nombre], nos complace informarle..."},{id:"friendly",name:"Amigable",description:"Cercano y c\xe1lido",example:"\xa1Hola [nombre]! Esperamos verte pronto..."},{id:"professional",name:"Profesional",description:"Directo y eficiente",example:"Hola [nombre], su cita est\xe1 confirmada..."}];function H(e){var s;let{isOpen:a,onClose:l,onSubmit:i,availableColumns:c}=e,[x,u]=(0,r.useState)(1),[f,b]=(0,r.useState)({businessName:"",businessType:"",messageType:"",tone:"professional",requiredVariables:[],customVariables:"",sampleMessage:"",contactInfo:{name:"",email:"",phone:""},urgency:"standard"}),[N,v]=(0,r.useState)([]);if(!a)return null;let y=e=>{v(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},w=()=>{switch(x){case 1:return f.businessName&&f.businessType&&f.messageType;case 2:return f.tone&&N.length>0;case 3:return f.sampleMessage.trim().length>0;case 4:return f.contactInfo.name&&f.contactInfo.email;default:return!1}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden animate-slide-up",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(Z.Y,{icon:D.Z,size:28,animation:"pulse"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Plantilla Personalizada"}),(0,t.jsx)("p",{className:"text-purple-100",children:"Dise\xf1ada espec\xedficamente para su negocio"})]})]}),(0,t.jsx)(g.z,{variant:"ghost",size:"sm",onClick:l,className:"text-white hover:bg-white/20 p-2",children:(0,t.jsx)(z.Z,{size:24})})]})}),(0,t.jsxs)("div",{className:"px-6 py-4 border-b",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-600",children:["Paso ",x," de 4"]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[Math.round(x/4*100),"% completado"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(x/4*100,"%")}})})]}),(0,t.jsxs)("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[1===x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(n.Z,{className:"mx-auto h-12 w-12 text-purple-600 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Informaci\xf3n del Negocio"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Cu\xe9ntenos sobre su empresa para personalizar la plantilla"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de su empresa/cl\xednica"}),(0,t.jsx)("input",{type:"text",value:f.businessName,onChange:e=>b(s=>({...s,businessName:e.target.value})),placeholder:"Ej: Cl\xednica Salud Integral",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de negocio"}),(0,t.jsx)("input",{type:"text",value:f.businessType,onChange:e=>b(s=>({...s,businessType:e.target.value})),placeholder:"Ej: Cl\xednica m\xe9dica, Sal\xf3n de belleza, Restaurante",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de mensaje"}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-3",children:B.map(e=>(0,t.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",value:e.id,checked:f.messageType===e.id,onChange:e=>b(s=>({...s,messageType:e.target.value})),className:"mt-1 text-purple-600 focus:ring-purple-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.description})]})]},e.id))})]})]})]}),2===x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(A.Z,{className:"mx-auto h-12 w-12 text-purple-600 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Configuraci\xf3n de Plantilla"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Defina el tono y las variables a usar"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tono deseado"}),(0,t.jsx)("div",{className:"space-y-3",children:W.map(e=>(0,t.jsx)("div",{className:"p-4 border rounded-lg cursor-pointer transition-all ".concat(f.tone===e.id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),onClick:()=>b(s=>({...s,tone:e.id})),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1 italic",children:e.example})]}),(0,t.jsx)("div",{className:"w-4 h-4 rounded-full border-2 ".concat(f.tone===e.id?"border-purple-500 bg-purple-500":"border-gray-300")})]})},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Variables disponibles en sus datos"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:c.map(e=>(0,t.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:N.includes(e),onChange:()=>y(e),className:"text-purple-600 focus:ring-purple-500 rounded"}),(0,t.jsx)("code",{className:"text-sm bg-gray-100 px-2 py-1 rounded",children:"{".concat(e,"}")})]},e))}),N.length>0&&(0,t.jsx)("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-purple-800",children:[(0,t.jsx)("strong",{children:"Variables seleccionadas:"})," ",N.map(e=>"{".concat(e,"}")).join(", ")]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Variables adicionales (opcional)"}),(0,t.jsx)("textarea",{value:f.customVariables,onChange:e=>b(s=>({...s,customVariables:e.target.value})),placeholder:"Ej: especialidad, ubicaci\xf3n, horario especial, etc.",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]})]}),3===x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(h.Z,{className:"mx-auto h-12 w-12 text-purple-600 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Mensaje de Ejemplo"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Proporcione un ejemplo o inspiraci\xf3n para su plantilla"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mensaje ejemplo o inspiraci\xf3n"}),(0,t.jsx)("textarea",{value:f.sampleMessage,onChange:e=>b(s=>({...s,sampleMessage:e.target.value})),placeholder:"Escriba un ejemplo del mensaje que le gustar\xeda enviar a sus clientes...",rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"}),(0,t.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Sea espec\xedfico sobre el tono y la informaci\xf3n que debe incluir"}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[f.sampleMessage.length," caracteres"]})]})]}),(0,t.jsx)(j.Zb,{className:"bg-blue-50 border-blue-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(m.Z,{className:"text-blue-600 flex-shrink-0 mt-0.5",size:16}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-900",children:"Consejo"}),(0,t.jsx)("p",{className:"text-sm text-blue-800 mt-1",children:"Incluya detalles espec\xedficos de su industria y el tipo de comunicaci\xf3n que necesita. Nuestros expertos usar\xe1n esta informaci\xf3n para crear una plantilla perfecta."})]})]})})]}),4===x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(o.Z,{className:"mx-auto h-12 w-12 text-purple-600 mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Informaci\xf3n de Contacto"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Para entregarle su plantilla personalizada"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre completo"}),(0,t.jsx)("input",{type:"text",value:f.contactInfo.name,onChange:e=>b(s=>({...s,contactInfo:{...s.contactInfo,name:e.target.value}})),placeholder:"Su nombre completo",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tel\xe9fono"}),(0,t.jsx)("input",{type:"tel",value:f.contactInfo.phone,onChange:e=>b(s=>({...s,contactInfo:{...s.contactInfo,phone:e.target.value}})),placeholder:"300 123 4567",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo electr\xf3nico"}),(0,t.jsx)("input",{type:"email",value:f.contactInfo.email,onChange:e=>b(s=>({...s,contactInfo:{...s.contactInfo,email:e.target.value}})),placeholder:"su@email.com",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-gray-900"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tiempo de entrega"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("label",{className:"flex items-center justify-between p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("input",{type:"radio",value:"standard",checked:"standard"===f.urgency,onChange:e=>b(s=>({...s,urgency:e.target.value})),className:"text-purple-600 focus:ring-purple-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:"Est\xe1ndar (24-48 horas)"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Entrega en 1-2 d\xedas h\xe1biles"})]})]}),(0,t.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"$85,000"})]}),(0,t.jsxs)("label",{className:"flex items-center justify-between p-4 border rounded-lg cursor-pointer hover:bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("input",{type:"radio",value:"express",checked:"express"===f.urgency,onChange:e=>b(s=>({...s,urgency:e.target.value})),className:"text-purple-600 focus:ring-purple-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:"Express (12-24 horas)"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Entrega el mismo d\xeda o siguiente"})]})]}),(0,t.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:"$125,000"})]})]})]}),(0,t.jsxs)(j.Zb,{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",padding:"lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Resumen del Servicio"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Z,{size:16,className:"text-green-600"}),(0,t.jsxs)("span",{children:["Plantilla personalizada para ",f.businessType]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Z,{size:16,className:"text-green-600"}),(0,t.jsxs)("span",{children:["Optimizada para ",N.length," variables de sus datos"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Z,{size:16,className:"text-green-600"}),(0,t.jsxs)("span",{children:["Tono ",null===(s=W.find(e=>e.id===f.tone))||void 0===s?void 0:s.name.toLowerCase()]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(p.Z,{size:16,className:"text-blue-600"}),(0,t.jsxs)("span",{children:["Entrega en ","express"===f.urgency?"12-24 horas":"24-48 horas"]})]})]})]})]})]}),(0,t.jsxs)("div",{className:"px-6 py-4 border-t bg-gray-50 flex items-center justify-between",children:[(0,t.jsx)("div",{children:x>1&&(0,t.jsx)(g.z,{variant:"outline",onClick:()=>{x>1&&u(x-1)},children:"Atr\xe1s"})}),(0,t.jsx)("div",{className:"flex items-center space-x-3",children:x<4?(0,t.jsxs)(g.z,{onClick:()=>{x<4&&u(x+1)},disabled:!w(),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:["Continuar",(0,t.jsx)(_.Z,{size:16,className:"ml-2"})]}):(0,t.jsxs)(g.z,{onClick:()=>{i({...f,requiredVariables:N})},disabled:!w(),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-lg px-8",children:["Solicitar Plantilla",(0,t.jsxs)("span",{className:"ml-2 font-bold",children:["$","express"===f.urgency?"125,000":"85,000"]})]})})]})]})})}var Y=a(37381);function G(e){let{isOpen:s,onClose:a,planType:r,messagesUsed:i,messagesLimit:n,messagesRequired:c}=e,o=(0,l.useRouter)();return s?(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(S.Z,{className:"w-6 h-6 text-orange-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"\xa1Necesitas m\xe1s mensajes!"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"L\xedmite alcanzado"})]})]}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-full hover:bg-gray-100",children:(0,t.jsx)(z.Z,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.Z,{className:"w-5 h-5 text-blue-600"}),(0,t.jsx)("span",{className:"font-medium text-gray-900",children:"Plan Actual"})]}),(0,t.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:{free:"Gratuito",basic:"B\xe1sico",pro:"Pro",enterprise:"Enterprise"}[r]||r})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Mensajes usados"}),(0,t.jsxs)("span",{className:"font-medium",children:[i,"/",n]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(Math.min(i/n*100,100),"%")}})})]})]}),(0,t.jsx)("div",{className:"bg-red-50 border border-red-100 rounded-xl p-4",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(S.Z,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"font-medium text-red-900",children:["Mensajes requeridos: ",(0,t.jsx)("span",{className:"text-red-700",children:c})]}),(0,t.jsxs)("p",{className:"text-sm text-red-700",children:["Te faltan ",(0,t.jsxs)("span",{className:"font-semibold",children:[c-(n-i)," mensajes"]})," para enviar esta campa\xf1a."]})]})]})}),(0,t.jsx)("div",{className:"text-center space-y-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-gray-600",children:[(0,t.jsx)(m.Z,{className:"w-5 h-5"}),(0,t.jsx)("p",{className:"text-sm",children:"Actualiza tu plan para enviar campa\xf1as m\xe1s grandes y desbloquear todas las funcionalidades"})]})})]}),(0,t.jsxs)("div",{className:"px-6 pb-6 flex space-x-3",children:[(0,t.jsx)("button",{onClick:a,className:"flex-1 px-4 py-2.5 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors",children:"Cerrar"}),(0,t.jsxs)("button",{onClick:()=>{a(),o.push("/dashboard/upgrade")},className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl font-medium transition-all transform hover:scale-105 flex items-center justify-center space-x-2",children:[(0,t.jsx)("span",{children:"Ver Planes"}),(0,t.jsx)(_.Z,{className:"w-4 h-4"})]})]})]})}):null}var $=a(76362),J=a(89534);function K(){let{user:e}=(0,$.a)(),s=(0,l.useRouter)(),a=(0,J.p)(),[f,b]=(0,r.useState)("upload"),[N,v]=(0,r.useState)(null),[y,w]=(0,r.useState)(""),[C,z]=(0,r.useState)(0),[S,Z]=(0,r.useState)([]),[E,D]=(0,r.useState)([]),[P,T]=(0,r.useState)({}),[V,M]=(0,r.useState)({}),[q,I]=(0,r.useState)(!1),[A,F]=(0,r.useState)(!1),[O,_]=(0,r.useState)(null),[B,W]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(null);console.log("Send Page State:",{currentStep:f,csvDataLength:S.length,availableColumnsLength:E.length,contactsCount:C,variableMappings:P,defaultValues:V});let X=[{id:"upload",label:"Cargar Contactos",icon:n.Z},{id:"template",label:"Elegir Plantilla",icon:c.Z},{id:"review",label:"Revisar y Enviar",icon:o.Z}],ee=(e,s)=>{console.log("Send Page - CSV Upload Complete:",{dataLength:e.length,columnsLength:s.length,columns:s.map(e=>({original:e.original,mapped:e.mapped}))}),Z(e),D(s),z(e.length)},es=e=>X.findIndex(s=>s.id===e),ea=async()=>{if(!N||0===S.length){alert("Error: No hay plantilla seleccionada o datos CSV");return}F(!0),b("sending");try{console.log("\uD83D\uDE80 Starting message sending process...");let e=i.T;console.log("\uD83D\uDCE1 Backend URL:",e);let s=new FormData;s.append("name","Campaign ".concat(new Date().toLocaleString()));let t=N.twilioSid;if(!t){a.error("Error de configuraci\xf3n","Esta plantilla no tiene configurado un ID de WhatsApp. Contacta al administrador."),setLoading(!1);return}s.append("templateSid",t),s.append("variableMappings",JSON.stringify(P)),s.append("defaultValues",JSON.stringify(V));let r=E.map(e=>e.original).join(","),l=S.map(e=>E.map(s=>e[s.original]||"").join(",")).join("\n"),n=new Blob([r+"\n"+l],{type:"text/csv"});s.append("csvFile",n,"contacts.csv"),console.log("\uD83D\uDCE4 Creating campaign with backend..."),console.log("\uD83D\uDCCB Campaign data:",{name:"Campaign ".concat(new Date().toLocaleString()),templateSid:t,contactsCount:S.length,variableMappings:P,defaultValues:V});let c=localStorage.getItem("token");if(!c)throw Error("No hay token de autenticaci\xf3n");let o=await fetch("".concat(e,"/api/campaigns/create"),{method:"POST",headers:{Authorization:"Bearer ".concat(c)},body:s}),d=await o.json();if(console.log("\uD83D\uDCDD Campaign creation response:",d),!o.ok||!d.success){if(403===o.status&&d.details){let e=d.details;Q(e),W(!0),F(!1);return}throw Error(d.error||"Error creating campaign (".concat(o.status,")"))}let m=d.campaign.id;console.log("\uD83D\uDCF1 Sending messages...");let x=await fetch("".concat(e,"/api/campaigns/").concat(m,"/send"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({confirm:"true"})});if(!x.ok)throw Error("HTTP error! status: ".concat(x.status));let p=await x.json();if(console.log("✅ Messages sent:",p),!p.success)throw Error(p.error||"Error sending messages");_({sent:p.campaign.sentCount||0,errors:p.campaign.errorCount||0,total:p.campaign.totalContacts||0,campaign:p.campaign,message:p.message})}catch(e){console.error("❌ Error sending messages:",e),alert("Error enviando mensajes: ".concat(e.message)),b("review")}finally{F(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-primary-50 to-secondary-50 rounded-xl p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Enviar Mensajes"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Env\xede notificaciones masivas de forma segura y eficiente"})]}),e&&(0,t.jsx)(Y.o,{variant:"banner",currentPlan:e.planType,messagesUsed:e.messagesUsed,messagesLimit:e.messagesLimit,showProgress:!0,urgent:e.messagesUsed>=e.messagesLimit}),(0,t.jsx)(j.Zb,{className:"bg-white",padding:"lg",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:X.map((e,s)=>{let a=e.id===f,r=es(e.id)<es(f);return(0,t.jsxs)("div",{className:"flex items-center flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"\n                      w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300\n                      ".concat(a?"bg-primary-600 text-white scale-110":"","\n                      ").concat(r?"bg-green-500 text-white":"","\n                      ").concat(a||r?"":"bg-gray-200 text-gray-500","\n                    "),children:r?(0,t.jsx)(d.Z,{size:20}):(0,t.jsx)(e.icon,{size:20})}),(0,t.jsx)("span",{className:"\n                      ml-3 font-medium transition-colors duration-300\n                      ".concat(a?"text-primary-700":"","\n                      ").concat(r?"text-green-700":"","\n                      ").concat(a||r?"":"text-gray-500","\n                    "),children:e.label})]}),s<X.length-1&&(0,t.jsx)("div",{className:"flex-1 mx-4",children:(0,t.jsx)("div",{className:"h-1 bg-gray-200 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"\n                          h-full transition-all duration-500 ease-out\n                          ".concat(r?"bg-green-500 w-full":"bg-gray-200 w-0","\n                        ")})})})]},e.id)})})}),(0,t.jsxs)("div",{className:"min-h-[400px]",children:["upload"===f&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(k,{onDataProcessed:(e,s)=>{console.log("Send Page - Received callback with:",{dataLength:e.length,columnsLength:s.length}),ee(e,s)},onContinue:()=>{E.length>0&&S.length>0&&b("template")}}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(j.Zb,{className:"bg-blue-50 border-blue-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(m.Z,{className:"text-blue-600 flex-shrink-0",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-900",children:"Procesamiento R\xe1pido"}),(0,t.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Validaci\xf3n instant\xe1nea de hasta 10,000 contactos"})]})]})}),(0,t.jsx)(j.Zb,{className:"bg-green-50 border-green-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(x.Z,{className:"text-green-600 flex-shrink-0",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-green-900",children:"100% Seguro"}),(0,t.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"Sus datos nunca salen de su navegador"})]})]})}),(0,t.jsx)(j.Zb,{className:"bg-purple-50 border-purple-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(p.Z,{className:"text-purple-600 flex-shrink-0",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-purple-900",children:"Eliminaci\xf3n Autom\xe1tica"}),(0,t.jsx)("p",{className:"text-sm text-purple-700 mt-1",children:"Datos borrados despu\xe9s del env\xedo"})]})]})})]}),E.length>0&&S.length>0&&(0,t.jsx)(j.Zb,{className:"bg-green-50 border-green-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(d.Z,{className:"text-green-600",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-green-800 font-medium",children:"\xa1Archivo procesado exitosamente!"}),(0,t.jsxs)("p",{className:"text-green-700 text-sm",children:[E.length," columnas y ",S.length," contactos detectados. Listo para continuar."]})]})]}),(0,t.jsxs)(g.z,{size:"lg",className:"gradient-primary",onClick:()=>b("template"),children:["Siguiente Paso",(0,t.jsx)(u.Z,{className:"ml-2",size:20})]})]})}),(0,t.jsx)(j.Zb,{className:"bg-yellow-50 border-yellow-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-yellow-800 font-medium",children:"DEBUG: Probar con datos simulados"}),(0,t.jsx)("p",{className:"text-yellow-700 text-sm",children:"Esto simular\xe1 datos de CSV para probar el sistema de plantillas"})]}),(0,t.jsx)(g.z,{onClick:()=>{let e=[{nombre:"Juan P\xe9rez",telefono:"3001234567",fecha:"2024-01-15",hora:"14:30",doctor:"Dr. Garc\xeda",servicio:"Consulta General",ubicacion:"Consultorio 201"},{nombre:"Mar\xeda L\xf3pez",telefono:"3157894561",fecha:"2024-01-16",hora:"10:00",doctor:"Dra. Rodr\xedguez",servicio:"Manicure y Pedicure",ubicacion:"Sal\xf3n Principal"},{nombre:"Carlos S\xe1nchez",telefono:"3226667788",fecha:"2024-01-17",hora:"16:15",doctor:"Dr. Mart\xednez",servicio:"Consulta Especializada",ubicacion:"Torre M\xe9dica Piso 3"}],s=[{original:"nombre",mapped:"nombre",type:"text",completeness:100,required:!0},{original:"telefono",mapped:"telefono",type:"phone",completeness:100,required:!0},{original:"fecha",mapped:"fecha",type:"date",completeness:100,required:!1},{original:"hora",mapped:"hora",type:"time",completeness:100,required:!1},{original:"doctor",mapped:"doctor",type:"text",completeness:100,required:!1},{original:"servicio",mapped:"servicio",type:"text",completeness:100,required:!1},{original:"ubicacion",mapped:"ubicacion",type:"text",completeness:100,required:!1}];console.log("Test button - setting test data:",{testData:e,testColumns:s}),Z(e),D(s),z(e.length)},variant:"outline",size:"sm",children:"Usar Datos de Prueba"})]})})]}),"template"===f&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(L,{onSelectTemplate:e=>{v({id:e.id,name:e.name,category:e.category,preview:e.content,requiredVariables:e.variables,optionalVariables:[],usageCount:0,description:"".concat("active"===e.status?"Activa":"Aprobada"),twilioSid:e.twilioContentSid||e.twilioSid||e.twilioTemplateId}),w(e.content)},selectedTemplate:N})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"sticky top-6",children:[(0,t.jsx)(R,{template:N,availableColumns:E,csvData:S,onVariableMapping:T,onDefaultValues:M}),E.length>0&&(0,t.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-xs",children:[(0,t.jsx)("strong",{children:"Debug:"})," ",E.length," columnas disponibles: "," ",E.map(e=>"".concat(e.original,"(").concat(e.mapped,")")).join(", ")]}),N&&(0,t.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,t.jsx)(g.z,{size:"lg",className:"w-full gradient-primary cta-glow",onClick:()=>b("review"),children:"Continuar a Revisi\xf3n"}),(0,t.jsx)(g.z,{size:"lg",variant:"outline",className:"w-full",onClick:()=>b("upload"),children:"Atr\xe1s"})]})]})})]}),"review"===f&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(j.Zb,{className:"bg-white",padding:"lg",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Revise antes de enviar"}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,t.jsx)(n.Z,{className:"text-blue-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Destinatarios"}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-900",children:C})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,t.jsx)(h.Z,{className:"text-green-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Caracteres"}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-900",children:y.length})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-purple-100",children:(0,t.jsx)(p.Z,{className:"text-purple-600",size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Tiempo estimado"}),(0,t.jsx)("p",{className:"text-xl font-bold text-gray-900",children:"5 min"})]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Vista previa del mensaje"}),(0,t.jsx)(j.Zb,{className:"bg-gray-50",padding:"md",children:(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:y})})]}),(0,t.jsx)(j.Zb,{className:"bg-blue-50 border-blue-200",padding:"md",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)(x.Z,{className:"text-blue-600 flex-shrink-0",size:20}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-blue-900",children:"Recordatorio de Privacidad"}),(0,t.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Todos los datos ser\xe1n eliminados autom\xe1ticamente despu\xe9s del env\xedo. No conservamos ninguna informaci\xf3n personal."})]})]})})]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(g.z,{size:"lg",variant:"outline",onClick:()=>b("template"),children:"Atr\xe1s"}),(0,t.jsxs)(g.z,{size:"lg",className:e&&e.messagesUsed>=e.messagesLimit?"bg-red-600 hover:bg-red-700 text-white cursor-not-allowed":"gradient-primary cta-glow",onClick:e&&e.messagesUsed>=e.messagesLimit?()=>s.push("/dashboard/upgrade"):ea,disabled:A,children:[(0,t.jsx)(o.Z,{className:"mr-2",size:20}),e&&e.messagesUsed>=e.messagesLimit?"\xa1Comprar Plan para Enviar!":A?"Enviando...":"Enviar ".concat(C," Mensajes")]})]})]}),"sending"===f&&(0,t.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,t.jsx)(j.Zb,{className:"bg-white text-center",padding:"xl",children:(0,t.jsx)("div",{className:"space-y-6",children:O?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:(0,t.jsx)(d.Z,{className:"text-green-600",size:32})}),(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"\xa1Mensajes enviados!"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,t.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-green-600",children:O.sent}),(0,t.jsx)("p",{className:"text-sm text-green-700",children:"Enviados exitosamente"})]}),(0,t.jsxs)("div",{className:"p-4 bg-red-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-red-600",children:O.errors}),(0,t.jsx)("p",{className:"text-sm text-red-700",children:"Errores"})]})]}),(0,t.jsx)("div",{className:"p-4 bg-blue-50 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["Total procesados: ",(0,t.jsx)("span",{className:"font-semibold",children:O.total})]})})]}),(0,t.jsxs)("div",{className:"flex justify-center space-x-4",children:[(0,t.jsx)(g.z,{onClick:()=>{b("upload"),_(null),Z([]),D([]),v(null),T({}),M({}),z(0)},variant:"outline",children:"Enviar Nuevos Mensajes"}),(0,t.jsx)(g.z,{onClick:()=>b("review"),className:"gradient-primary",children:"Regresar"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto"}),(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-900",children:"Enviando mensajes..."}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Por favor espere mientras procesamos ",C," mensajes"]})]})})})})]}),(0,t.jsx)(U,{availableColumns:E,templates:[],onTemplateRecommend:e=>{v(e),w(e.preview),b("template")},onCustomTemplateRequest:()=>I(!0)}),(0,t.jsx)(H,{isOpen:q,onClose:()=>I(!1),onSubmit:e=>{console.log("Custom template request:",e),I(!1),alert("Solicitud de plantilla personalizada enviada. Nos contactaremos pronto.")},availableColumns:E.map(e=>e.mapped)}),(0,t.jsx)(G,{isOpen:B,onClose:()=>W(!1),planType:(null==e?void 0:e.planType)||"free",messagesUsed:(null==e?void 0:e.messagesUsed)||0,messagesLimit:(null==e?void 0:e.messagesLimit)||10,messagesRequired:(null==K?void 0:K.required)||0})]})}},89534:function(e,s,a){"use strict";a.d(s,{ToastProvider:function(){return m},p:function(){return u}});var t=a(57437),r=a(2265),l=a(41671),i=a(99388),n=a(76865),c=a(33245),o=a(32489);let d=(0,r.createContext)(void 0);function m(e){let{children:s}=e,[a,l]=(0,r.useState)([]),i=(0,r.useCallback)(e=>{l(s=>s.filter(s=>s.id!==e))},[]),n=(0,r.useCallback)(e=>{let s=Math.random().toString(36).substring(2,15),a={...e,id:s};l(e=>[...e,a]),setTimeout(()=>{i(s)},e.duration||5e3)},[i]),c=(0,r.useCallback)((e,s)=>{n({type:"success",title:e,message:s})},[n]),o=(0,r.useCallback)((e,s)=>{n({type:"error",title:e,message:s,duration:7e3})},[n]),m=(0,r.useCallback)((e,s)=>{n({type:"warning",title:e,message:s})},[n]),p=(0,r.useCallback)((e,s)=>{n({type:"info",title:e,message:s})},[n]);return(0,t.jsxs)(d.Provider,{value:{toasts:a,addToast:n,removeToast:i,success:c,error:o,warning:m,info:p},children:[s,(0,t.jsx)(x,{})]})}function x(){let{toasts:e,removeToast:s}=u();return(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,t.jsx)(p,{toast:e,onRemove:s},e.id))})}function p(e){let{toast:s,onRemove:a}=e;return(0,t.jsx)("div",{className:"\n      max-w-sm w-full bg-white rounded-lg shadow-lg border-l-4 p-4 animate-slide-in-right\n      ".concat((()=>{switch(s.type){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800"}})(),"\n    "),children:(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(()=>{switch(s.type){case"success":return(0,t.jsx)(l.Z,{className:"w-5 h-5 text-green-500"});case"error":return(0,t.jsx)(i.Z,{className:"w-5 h-5 text-red-500"});case"warning":return(0,t.jsx)(n.Z,{className:"w-5 h-5 text-yellow-500"});case"info":return(0,t.jsx)(c.Z,{className:"w-5 h-5 text-blue-500"})}})()}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:s.title}),s.message&&(0,t.jsx)("p",{className:"mt-1 text-sm opacity-90",children:s.message})]}),(0,t.jsx)("button",{onClick:()=>a(s.id),className:"ml-2 flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(o.Z,{className:"w-4 h-4"})})]})})}function u(){let e=(0,r.useContext)(d);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},8530:function(e,s,a){"use strict";a.d(s,{T:function(){return t}});let t="http://localhost:3005"}},function(e){e.O(0,[425,14,93,690,971,117,744],function(){return e(e.s=47761)}),_N_E=e.O()}]);